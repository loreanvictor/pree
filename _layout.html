<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="/" />

    <title>pree: prebuild html files</title>
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.ico">

    <style>
      @import 'https://unpkg.com/nokss' layer(base);
    </style>
    <link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'"
      href="https://esm.sh/graphis/font/graphis.css" >
    <link rel="stylesheet" href="./assets/styles/theme.css" />
    
    <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">

    <script build-only type="module" src="./assets/components/use-html.js"></script>
    <script build-only type="module" src="./assets/components/m-d.js"></script>
    <script build-only type="module" src="./assets/components/change-history.js"></script>
    <script build-only type="module" src="./assets/components/local-style.js"></script>
    <script build-only type="module" src="./assets/components/small-device.js"></script>

    <script src="./assets/components/emo-li.js" type="module"></script>
    <script type="module" src="./assets/components/prev-next.js"></script>

    <script type="module">
      import 'https://unpkg.com/@hotwired/turbo@8.0.4/dist/turbo.es2017-esm.js';
    </script>
  </head>
  <body>
    <slot name="background"></slot>
    <aside aria-hidden="true">
      <turbo-frame id="side-bar" target="main" data-turbo-action="advance">
        <use-html src="./_toc.html"></use-html>
      </turbo-frame>
    </aside>
    <main>
      <turbo-frame id="main" data-turbo-action="advance">
        <slot></slot>
        <prev-next></prev-next>
        <slot name="watermark">
          <use-html src="./_watermark.html"></use-html>
        </slot>
      </turbo-frame>
    </main>

    <footer>
      <turbo-frame id="footer" target="main" data-turbo-action="advance">
        <use-html src="./_footer.html"></use-html>
      </turbo-frame>
    </footer>

    <script type="module" build-only>
      addEventListener('turbo:load', () => hljs.highlightAll())
      addEventListener('turbo:click', () => hljs.highlightAll())
    </script>
    <script type="module">
      import { addCopyButtons, addHeaderLinks } from './assets/scripts/copy.js'

      const prep = () => {        
        addCopyButtons()
        addHeaderLinks()
      }

      addEventListener('turbo:load', prep)
      addEventListener('turbo:click', prep)
    </script>
    <script>
      const main = document.querySelector('main')
      addEventListener('turbo:before-frame-render', (event) => {
        main.style.filter = 'blur(3px)'
        main.style.opacity = .5
        main.style.transition = 'filter .1s, opacity .1s'
        event.preventDefault()
        setTimeout(() => {
          event.detail.resume()
          scrollTo(0, 0)
          main.style.transition = 'none'
          main.style.filter = 'none'
          main.style.opacity = 1
        }, 100)
      })
    </script>
  </body>
</html>
